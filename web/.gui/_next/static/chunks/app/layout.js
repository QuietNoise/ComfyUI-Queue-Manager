(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{516:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>g});var r=t(5155),s=t(4233),a=t.n(s),o=t(5427),l=t.n(o);t(2514);var i=t(2115);function c(e){let{data:n,isLoading:t,error:s,progress:a}=e,[o,l]=(0,i.useState)({pending:[],running:[]});function c(e){let{children:n,className:t,onClick:s}=e;return(0,r.jsx)("button",{className:"hover:bg-neutral-700 text-neutral-200 font-bold py-1 px-2 rounded mr-1"+(t?" "+t:""),onClick:s,children:n})}function d(e){let{item:n,className:t,loader:s}=e,[a,o]=(0,i.useState)(!1);async function l(){o(!0);try{if(!(await fetch("".concat("/","api/queue"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({delete:[n[1]]})})).ok)throw Error("Network response was not ok");o(!1)}catch(e){o(!1),console.error("Error fetching queue items:",e)}}async function d(){window.parent.postMessage({type:"QM_LoadWorkflow",workflow:n[3].extra_pnginfo.workflow,number:n[0]},"*")}return(0,r.jsxs)("tr",{className:"dark:odd:bg-neutral-900 odd:bg-neutral-100"+(t?" "+t:""),children:[(0,r.jsx)("td",{className:"px-3 py-1 serial",children:(0,r.jsx)("span",{children:n[0]})}),(0,r.jsx)("td",{className:"px-3 py-1 text-left name",children:n[3].extra_pnginfo.workflow.workflow_name?n[3].extra_pnginfo.workflow.workflow_name:""}),(0,r.jsxs)("td",{className:"px-3 py-1 text-right actions",children:[s&&(0,r.jsx)("span",{className:"loader px-3 py-1 ",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})})}),(0,r.jsx)(c,{className:"bg-red-900",onClick:l,children:"Delete"}),(0,r.jsx)(c,{className:"bg-green-900",onClick:d,children:"Load"}),(0,r.jsx)(c,{className:"bg-orange-900",children:"Archive"})]})]})}return((0,i.useEffect)(function(){n&&l({pending:n.pending?[...n.pending].sort((e,n)=>e[0]-n[0]):[],running:n.running?[...n.running].sort((e,n)=>e[0]-n[0]):[]})},[n]),s)?(0,r.jsxs)("p",{className:"text-red-500 text-center",children:["Queue load failed: ",s.message]}):n&&(n.running.length||n.pending.length)?(0,r.jsx)("div",{className:"overflow-x-auto"+(t?" loading":""),style:{"--job-progress":a+"%"},children:(0,r.jsxs)("table",{className:"min-w-full border border-0",children:[(0,r.jsx)("thead",{className:"dark:bg-neutral-800 bg-neutral-200 text-xs uppercase",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"#"}),(0,r.jsx)("th",{className:"px-3 py-2 text-left",children:"Workflow"}),(0,r.jsx)("th",{className:"px-3 py-2 text-right",children:"Actions"})]})}),(0,r.jsxs)("tbody",{children:[o.running.map(e=>(0,r.jsx)(d,{item:e,className:"running",loader:!0},e[0])),o.pending.map(e=>(0,r.jsx)(d,{item:e,className:"pending"},e[0]))]})]})}):(0,r.jsx)("p",{className:"italic text-center",children:"Queue is empty."})}let d="undefined"!=typeof window?i.useInsertionEffect||i.useLayoutEffect:()=>{};function u(){throw Error("INVALID_USEEVENT_INVOCATION: the callback from useEvent cannot be invoked before the component has mounted.")}let f=function(e){let n=i.useRef(u);d(()=>{n.current=e},[e]);let t=i.useRef(null);return t.current||(t.current=function(){return n.current.apply(this,arguments)}),t.current};function g(e){let{children:n}=e,[t,s]=(0,i.useState)({loading:!1,error:null,queue:null}),[o,d]=(0,i.useState)({id:null,nodes:{},integrity:!0,progress:0}),u=async()=>{s(e=>({...e,loading:!0,error:null}));try{let e=await fetch("".concat("/","queue_manager/queue"));if(!e.ok)throw Error("Network response was not ok");let n=await e.json();s(e=>({...e,loading:!1,error:null,queue:n}))}catch(e){s(n=>({...n,loading:!1,error:e.message,queue:null})),console.error("Error fetching queue items:",e)}};function g(e){let n={};for(let t of e)t.id&&(n[t.id]=t.id);return n}function h(e,n){if(!n)return null;for(let t of n.running)if(t[1]===e)return t;for(let t of n.pending)if(t[1]===e)return t;return null}let m=f(e=>{if("QM_queueStatusUpdated"===e.data.type)switch(e.data.message.name){case"status":u();break;case"execution_start":let{prompt_id:n}=e.data.message.detail,r=h(n,t.queue);if(r){let e=g(r[3].extra_pnginfo.workflow.nodes);d(t=>({...t,id:n,nodes:e,integrity:!0}));break}d(e=>({...e,id:n,integrity:!1,nodes:{}}));break;case"execution_cached":let{nodes:s}=e.data.message.detail;if(!s||0===s.length)return;let a={};for(let e of s)a[e]=!0;d(e=>({...e,nodes:{...e.nodes,...a}}));break;case"executing":console.log("Executing: ",e.data.message);let o=e.data.message.detail;if(!o)return;d(e=>({...e,nodes:{...e.nodes,[o]:!0}}))}});return(0,i.useEffect)(()=>{let e=Object.values(o.nodes).length>0?Math.round(Math.max(Object.values(o.nodes).filter(e=>"boolean"==typeof e).length-1,0)/Object.values(o.nodes).length*100,2):0;d(n=>({...n,progress:e}))},[o.nodes]),(0,i.useEffect)(()=>{if(o.id&&!1===o.integrity){let e=h(o.id,t.queue);if(e){let n=g(e[3].extra_pnginfo.workflow.nodes);for(let e in o.nodes)!0===o.nodes[e]&&(n[e]=!0);d(e=>({...e,nodes:n,integrity:!0}))}}},[t.queue]),(0,i.useEffect)(()=>(u(),window.addEventListener("message",m),()=>window.removeEventListener("message",m)),[]),(0,r.jsxs)("html",{lang:"en",children:[(0,r.jsxs)("head",{children:[(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("title",{children:"Queue Manager"}),(0,r.jsx)("meta",{name:"description",content:"ComfyUI Queue Manager frontend"})]}),(0,r.jsxs)("body",{className:"".concat(a().variable," ").concat(l().variable," p-2"),children:[(0,r.jsx)("div",{className:"queue-table ",children:(0,r.jsx)(c,{data:t.queue,error:t.error,isLoading:t.isLoading,progress:o.progress})}),(0,r.jsx)("footer",{className:"footer",children:(0,r.jsx)("div",{className:"p-2",children:t.queue&&t.queue.length>0&&(0,r.jsx)("button",{onClick:function(){},className:"hover:bg-neutral-700 text-neutral-200 font-bold py-1 px-2 rounded mr-1 border-0 bg-green-900",children:"Archive All"})})})]})]})}},2514:()=>{},4233:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_2b89fc",variable:"__variable_2b89fc"}},5427:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_1479a9",variable:"__variable_1479a9"}},6042:(e,n,t)=>{Promise.resolve().then(t.bind(t,516))}},e=>{var n=n=>e(e.s=n);e.O(0,[449],()=>n(6042)),_N_E=e.O()}]);